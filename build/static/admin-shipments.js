!function(){var e,n;window.shipments=window.shipments||{},window.shipments.admin=window.shipments.admin||{},e=jQuery,(n=window.shipments).admin.shipments={params:{},shipments:{},$wrapper:!1,needsSaving:!1,needsShipments:!0,needsReturns:!1,init:function(){var i=n.admin.shipments;i.params=wc_gzd_shipments_admin_shipments_params,i.$wrapper=e("#panel-order-shipments"),i.needsShipments=i.$wrapper.find("#order-shipment-add").is(":visible"),i.needsReturns=i.$wrapper.find("#order-return-shipment-add").is(":visible"),i.initShipments(),e(document).ajaxComplete(i.onAjaxComplete),e(document).on("click","#order-shipments-list .shipment-header",i.onToggleShipment).on("change","#order-shipments-list :input:visible",i.setNeedsSaving).on("click","#panel-order-shipments #order-shipment-add",i.onAddShipment).on("click","#panel-order-shipments .remove-shipment",i.onRemoveShipment).on("click","#panel-order-shipments button#order-shipments-save",i.onSave).on("click","#panel-order-shipments .notice-dismiss",i.onRemoveNotice).on("change",".shipments-create-label #product_id",i.onChangeLabelProductId),e(document).on("wc_gzd_shipments_admin_shipment_modal_after_submit_success","a#order-return-shipment-add",i.onAddReturnSuccess),e("#panel-order-shipments #order-return-shipment-add").wc_gzd_shipments_admin_shipment_modal(),e(document.body).on("init_tooltips",i.initTiptip),i.initTiptip()},onAjaxComplete:function(e,i,t){var s=n.admin.shipments;if(null!=i&&t.hasOwnProperty("data")){var r=t.data,a=!1;try{a=JSON.parse('{"'+r.replace(/&/g,'","').replace(/=/g,'":"')+'"}',(function(e,n){return""===e?n:decodeURIComponent(n)}))}catch(e){a=!1}if(a&&a.hasOwnProperty("action")){var p=a.action;"woocommerce_save_order_items"!==p&&"woocommerce_remove_order_item"!==p&&"woocommerce_add_order_item"!==p&&"woocommerce_delete_refund"!==p||s.syncItemQuantities()}}},syncItemQuantities:function(){var e=n.admin.shipments;e.block();var i={action:"woocommerce_gzd_validate_shipment_item_quantities",active:e.getActiveShipmentId()};e.doAjax(i,e.onSyncSuccess)},onSyncSuccess:function(e){var i=n.admin.shipments;i.unblock(),i.initShipments(),i.initTiptip()},onSave:function(e){var i=n.admin.shipments;return e.preventDefault(),i.save(),!1},save:function(){var e=n.admin.shipments;e.block();var i={action:"woocommerce_gzd_save_shipments",active:e.getActiveShipmentId()};e.doAjax(i,e.onSaveSuccess)},initShipment:function(i){var t=n.admin.shipments;t.shipments.hasOwnProperty(i)?t.shipments[i].refreshDom():t.shipments[i]=new e.shipmentsShipment(i)},onSaveSuccess:function(e){var i=n.admin.shipments;i.initShipments(),i.setNeedsSaving(!1),i.unblock(),i.initTiptip()},getActiveShipmentId:function(){var e=n.admin.shipments.$wrapper.find(".order-shipment.active");return e.length>0&&e.data("shipment")},block:function(){n.admin.shipments.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){n.admin.shipments.$wrapper.unblock()},getData:function(i){var t=n.admin.shipments,s={};return i=i||{},e.each(t.$wrapper.find(":input[name]").serializeArray(),(function(n,i){-1!==i.name.indexOf("[]")?(i.name=i.name.replace("[]",""),s[i.name]=e.makeArray(s[i.name]),s[i.name].push(i.value)):s[i.name]=i.value})),e.extend(s,i),s},refresh:function(i){var t=n.admin.shipments,s=t.getShipment(t.getActiveShipmentId());current_packaging_id=!1,s&&(current_packaging_id=s.getShipment().find(".shipment-packaging-select").val()),i.hasOwnProperty("order_needs_new_shipments")&&t.setNeedsShipments(i.order_needs_new_shipments),i.hasOwnProperty("order_needs_new_returns")&&t.setNeedsReturns(i.order_needs_new_returns);var r=i.hasOwnProperty("shipments")?i.shipments:{};e.each(t.getShipments(),(function(e,n){r.hasOwnProperty(e)&&(n.setIsEditable(r[e].is_editable),n.setNeedsItems(r[e].needs_items),n.setWeight(r[e].weight),n.setLength(r[e].length),n.setWidth(r[e].width),n.setHeight(r[e].height),n.setTotalWeight(r[e].total_weight),t.initShipment(e))})),(i.hasOwnProperty("needs_refresh")||i.hasOwnProperty("needs_packaging_refresh"))&&i.hasOwnProperty("shipment_id")&&(t.initShipment(i.shipment_id),i.hasOwnProperty("needs_packaging_refresh")&&(s=t.getShipment(t.getActiveShipmentId()))&&(new_packaging_id=s.getShipment().find(".shipment-packaging-select").val(),new_packaging_id!==current_packaging_id&&t.getShipment(i.shipment_id).refreshDimensions()))},doAjax:function(i,t,s){var r=n.admin.shipments,a=r.params.ajax_url,p=r.$wrapper,o=!0;p.find(".notice-wrapper").empty(),t=t||r.onAjaxSuccess,s=s||r.onAjaxError,i.hasOwnProperty("refresh_fragments")&&(o=i.refresh_fragments),i.hasOwnProperty("security")||(i.security=r.params.edit_shipments_nonce),i.hasOwnProperty("order_id")||(i.order_id=r.params.order_id),i=r.getData(i),e.ajax({type:"POST",url:a,data:i,success:function(n){n.success?(o&&n.fragments&&e.each(n.fragments,(function(n,i){e(n).replaceWith(i),e(n).unblock()})),t.apply(p,[n]),r.refresh(n),r.initTiptip()):(s.apply(p,[n]),r.unblock(),n.hasOwnProperty("message")?r.addNotice(n.message,"error"):n.hasOwnProperty("messages")&&e.each(n.messages,(function(e,n){r.addNotice(n,"error")})),r.initTiptip())},error:function(e){s.apply(p,[e]),r.unblock(),r.initTiptip()},dataType:"json"})},onAjaxError:function(e){},onAjaxSuccess:function(e){},onRemoveNotice:function(){e(this).parents(".notice").slideUp(150,(function(){e(this).remove()}))},addNotice:function(e,i){n.admin.shipments.$wrapper.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+i+'"><p>'+e+'</p><button type="button" class="notice-dismiss"></button></div>')},onChangeLabelProductId:function(){n.admin.shipments.showOrHideByLabelProduct(e(this).val())},showOrHideByLabelProduct:function(n){e(".shipments-create-label").find("p.form-field :input[data-products-supported]").each((function(){var i=e(this),t=i.data("products-supported");if(t.length>0)if(t.indexOf("&")>-1&&i.is("select")){var s=t.split("&").filter(Boolean),r=!1;e.each(s,(function(t,s){var a=s.split("=").filter(Boolean);if(a.length>1){var p=a[0],o=a[1].split(","),d=!0,m=i.find('option[value="'+p+'"]');m.length>0&&(-1!==e.inArray(n,o)&&(d=!1),d?(m.is(":selected")&&(r=!0),m.hide()):m.show())}}));var a=!0;i.find("option").each((function(){if("none"!==e(this).css("display"))return r&&e(this).prop("selected",!0),a=!1,!1})),a?(i.parents(".form-field").hide(),i.trigger("change")):(i.parents(".form-field").show(),i.trigger("change")),i.trigger("change")}else{var p=t.split(",").filter(Boolean),o=p.length>0;-1!==e.inArray(n,p)&&(o=!1),o?(i.parents(".form-field").hide(),i.trigger("change")):(i.parents(".form-field").show(),i.trigger("change"))}}))},getParams:function(){return n.admin.shipments.params},onRemoveShipment:function(){var i=n.admin.shipments,t=e(this).parents(".order-shipment").data("shipment");return window.confirm(i.getParams().i18n_remove_shipment_notice)&&i.removeShipment(t),!1},removeShipment:function(e){var i=n.admin.shipments,t={action:"woocommerce_gzd_remove_shipment",shipment_id:e};i.block(),i.doAjax(t,i.onRemoveShipmentSuccess,i.onRemoveShipmentError)},onRemoveShipmentSuccess:function(i){var t=n.admin.shipments,s=Array.isArray(i.shipment_id)?i.shipment_id:[i.shipment_id];e.each(s,(function(e,n){var i=t.$wrapper.find("#shipment-"+n);i.length>0&&(i.hasClass("active")?i.find(".shipment-content-wrapper").slideUp(300,(function(){i.removeClass("active"),i.remove(),t.initShipments()})):i.remove())})),t.initShipments(),t.unblock()},onRemoveShipmentError:function(e){n.admin.shipments.unblock()},onAddShipment:function(){return n.admin.shipments.addShipment(),!1},addShipment:function(){var e=n.admin.shipments;e.block(),e.doAjax({action:"woocommerce_gzd_add_shipment"},e.onAddShipmentSuccess,e.onAddShipmentError)},onAddShipmentSuccess:function(e){var i=n.admin.shipments;i.$wrapper.find(".order-shipment.active").length>0?i.$wrapper.find(".order-shipment.active").find(".shipment-content-wrapper").slideUp(300,(function(){i.$wrapper.find(".order-shipment.active").removeClass("active"),i.appendNewShipment(e),i.initShipments(),i.initTiptip(),i.unblock()})):(i.appendNewShipment(e),i.initShipments(),i.initTiptip(),i.unblock())},appendNewShipment:function(e){var i=n.admin.shipments;"simple"===e.new_shipment_type&&i.$wrapper.find(".panel-order-return-title").length>0?i.$wrapper.find(".panel-order-return-title").before(e.new_shipment):i.$wrapper.find("#order-shipments-list").append(e.new_shipment)},onAddShipmentError:function(e){},onAddReturnSuccess:function(e,i){n.admin.shipments.onAddShipmentSuccess(i)},setNeedsSaving:function(i){var t=n.admin.shipments,s=t.getActiveShipmentId(),r=!!s&&t.getShipment(s).getShipment();"boolean"!=typeof i&&(i=!0),t.needsSaving=!0===i,t.needsSaving?t.$wrapper.find("#order-shipments-save").show():t.$wrapper.find("#order-shipments-save").hide(),r&&(t.needsSaving?t.disableCreateButtons(r):t.enableCreateButtons(r)),t.hideOrShowFooter(),e(document.body).trigger("woocommerce_gzd_shipments_needs_saving",[t.needsSaving,t.getActiveShipmentId()]),t.initTiptip()},disableCreateButtons:function(i){var t=n.admin.shipments,s=i.find(".column-shipment-documents a.wc-gzd-shipment-action-button.create, .column-shipment-documents a.wc-gzd-shipment-action-button.refresh");s.length>0&&(s.addClass("disabled button-disabled"),s.each((function(){e(this).data("org-title",e(this).prop("title")),e(this).prop("title",t.params.i18n_save_before_create)})))},enableCreateButtons:function(i){n.admin.shipments;var t=i.find(".column-shipment-documents a.wc-gzd-shipment-action-button.create, .column-shipment-documents a.wc-gzd-shipment-action-button.refresh");t.length>0&&(t.removeClass("disabled button-disabled"),t.each((function(){e(this).data("org-title")&&e(this).prop("title",e(this).data("org-title"))})))},setNeedsShipments:function(e){var i=n.admin.shipments;"boolean"!=typeof e&&(e=!0),i.needsShipments=!0===e,i.needsShipments?(i.$wrapper.addClass("needs-shipments"),i.$wrapper.find("#order-shipment-add").show()):(i.$wrapper.removeClass("needs-shipments"),i.$wrapper.find("#order-shipment-add").hide()),i.hideOrShowFooter()},hideOrShowReturnTitle:function(){var e=n.admin.shipments;0===e.$wrapper.find(".order-shipment.shipment-return").length?e.$wrapper.find(".panel-order-return-title").addClass("hide-default"):e.$wrapper.find(".panel-order-return-title").removeClass("hide-default")},setNeedsReturns:function(e){var i=n.admin.shipments;"boolean"!=typeof e&&(e=!0),i.needsReturns=!0===e,i.needsReturns?(i.$wrapper.addClass("needs-returns"),i.$wrapper.find("#order-return-shipment-add").show()):(i.$wrapper.removeClass("needs-returns"),i.$wrapper.find("#order-return-shipment-add").hide()),i.hideOrShowFooter()},hideOrShowFooter:function(){var e=n.admin.shipments;e.needsSaving||e.needsShipments||e.needsReturns?e.$wrapper.find(".panel-footer").slideDown(300):e.$wrapper.find(".panel-footer").slideUp(300)},onToggleShipment:function(){var i=n.admin.shipments,t=e(this).parents(".order-shipment:first"),s=t.hasClass("active");i.closeShipments(),s||t.find("> .shipment-content-wrapper").slideDown(300,(function(){t.addClass("active")}))},closeShipments:function(){var e=n.admin.shipments;e.$wrapper.find(".order-shipment.active .shipment-content-wrapper").slideUp(300,(function(){e.$wrapper.find(".order-shipment.active").removeClass("active")}))},initShipments:function(){var i=n.admin.shipments;i.$wrapper=e("#panel-order-shipments"),i.$wrapper.find(".order-shipment").each((function(){var n=e(this).data("shipment");i.initShipment(n)})),i.hideOrShowReturnTitle()},getShipments:function(){return n.admin.shipments.shipments},getShipment:function(e){var i=n.admin.shipments.getShipments();return!!i.hasOwnProperty(e)&&i[e]},initTiptip:function(){var i=n.admin.shipments;i.$wrapper.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),i.$wrapper.find(".tip").tipTip({fadeIn:50,fadeOut:50,delay:200}),e(document.body).trigger("shipments_init_tooltips")}},e(document).ready((function(){n.admin.shipments.init()})),((window.wcGzdShipments=window.wcGzdShipments||{}).static=window.wcGzdShipments.static||{})["admin-shipments"]={}}();