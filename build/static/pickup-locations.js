!function(){var i,e;window.shipments=window.shipments||{},window.shipments.shipments_pickup_locations=window.shipments.shipments_pickup_locations||{},i=jQuery,(e=window.shipments).shipments_pickup_locations={params:{},pickupLocations:{},available:!1,currentProvider:"",init:function(){var o=e.shipments_pickup_locations;o.params=wc_gzd_shipments_pickup_locations_params;var n=o.getPickupLocationSelect();if(n.length>0){if(n.attr("data-locations"))try{o.pickupLocations=JSON.parse(n.attr("data-locations"))}catch(i){o.pickupLocations={}}n.attr("data-provider")&&(o.currentProvider=n.attr("data-provider"))}i("#current_pickup_location").length>0&&(o.available=i(".choose-pickup-location:visible").length>0||i(".currently-shipping-to:visible").length>0,i(document.body).on("updated_checkout",o.afterRefreshCheckout),i(document).on("change","#ship-to-different-address-checkbox",o.onSelectDifferentShipping),i(document).on("submit","#wc-gzd-shipments-pickup-location-search-form",o.onSearch),i(document).on("click",".submit-pickup-location",o.onSelectPickupLocation),i(document).on("change","#current_pickup_location",o.onChangeCurrentPickupLocation),i(document).on("click",".pickup-location-remove",o.onRemovePickupLocation),i(document).on("change","#pickup_location",o.onChangePickupLocation),i(document).on("change","#billing_postcode, #shipping_postcode",o.onChangeAddress),o.onChangeCurrentPickupLocation(),o.onChangePickupLocation(),o.maybeInitSelect2())},onChangeAddress:function(){e.shipments_pickup_locations;var o=i("#shipping_postcode:visible").val()?i("#shipping_postcode:visible").val():i("#billing_postcode").val();i("#pickup-location-postcode").val(o)},onChangePickupLocation:function(){e.shipments_pickup_locations.getPickupLocationSelect().val()?i(".pickup-location-search-actions").find(".submit-pickup-location").removeClass("hidden").show():i(".pickup-location-search-actions").find(".submit-pickup-location").addClass("hidden").hide()},hasPickupLocationDelivery:function(){return e.shipments_pickup_locations,!!i("#current_pickup_location").val()},disablePickupLocationDelivery:function(o=!1){var n=e.shipments_pickup_locations,t=i('.wc-gzd-modal-content[data-id="pickup-location"].active');if(i(".wc-gzd-shipments-managed-by-pickup-location").val(""),i("#current_pickup_location").val("").trigger("change"),t.length>0&&t.find(".wc-gzd-modal-close").trigger("click"),o){var c=i("form.checkout");c.find(".woocommerce-NoticeGroup-updateOrderReview").length<=0&&c.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview"></div>'),c.find(".woocommerce-NoticeGroup-updateOrderReview").prepend('<div class="woocommerce-info">'+n.params.i18n_pickup_location_delivery_unavailable+"</div>");var a=i(".woocommerce-NoticeGroup-updateOrderReview");i.scroll_to_notices(a)}},onRemovePickupLocation:function(){return e.shipments_pickup_locations.disablePickupLocationDelivery(),!1},getCustomerNumberField:function(){return i("#pickup_location_customer_number_field")},onChangeCurrentPickupLocation:function(){var o=e.shipments_pickup_locations,n=i("#current_pickup_location"),t=n.val(),c=!!t&&o.getPickupLocation(t),a=i(".pickup_location_notice");t&&c?(n.attr("data-current-location",JSON.stringify(c)),o.replaceShippingAddress(c.address_replacements),o.updateCustomerNumberField(c),a.find(".pickup-location-manage-link").text(c.label),a.find(".currently-shipping-to").show(),a.find(".choose-pickup-location").hide(),i("#wc-gzd-shipments-pickup-location-search-form .pickup-location-remove").removeClass("hidden").show()):(n.attr("data-current-location",""),n.val(""),o.getCustomerNumberField().addClass("hidden"),o.getCustomerNumberField().hide(),i(".wc-gzd-shipments-managed-by-pickup-location").find("input[type=text]").val(""),i(".wc-gzd-shipments-managed-by-pickup-location").find(":input").prop("readonly",!1),i("#wc-gzd-shipments-pickup-location-search-form .pickup-location-remove").addClass("hidden").hide(),i(".wc-gzd-shipments-managed-by-pickup-location").removeClass("wc-gzd-shipments-managed-by-pickup-location"),i(".wc-gzd-shipments-managed-by-pickup-location-notice").remove(),a.find(".currently-shipping-to").hide(),a.find(".choose-pickup-location").show())},onSearch:function(){var o=e.shipments_pickup_locations,n=i(this).serialize(),t=(o.getPickupLocationSelect().val(),o.pickupLocations);return i("#wc-gzd-shipments-pickup-location-search-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n+="&action=woocommerce_gzd_shipments_search_pickup_locations&context="+o.params.context,i.ajax({type:"POST",url:o.params.wc_ajax_url.toString().replace("%%endpoint%%","woocommerce_gzd_shipments_search_pickup_locations"),data:n,success:function(e){e.success&&(o.pickupLocations=e.locations,o.updatePickupLocationSelect(t),i("#wc-gzd-shipments-pickup-location-search-form").unblock())},error:function(i){},dataType:"json"}),!1},updatePickupLocationSelect:function(o=[]){var n=e.shipments_pickup_locations,t=n.getPickupLocationSelect(),c=t.val();try{t.attr("data-locations",JSON.stringify(n.pickupLocations))}catch(i){}t.find('option:not([value=""])').remove(),i.each(n.pickupLocations,(function(e,o){var n=i("<textarea />").html(o.formatted_address).text();t.append(i("<option></option>").attr("value",e).text(n))}));var a=n.getPickupLocation(c,!1);a&&(t.find('option[value="'+a.code+'"')[0].selected=!0);try{JSON.stringify(n.pickupLocations)!==JSON.stringify(o)&&t.trigger("change")}catch(i){}},onSelectDifferentShipping:function(){var o=e.shipments_pickup_locations;i(this).is(":checked")?i("#billing_pickup_location_notice").addClass("hidden").hide():(o.disablePickupLocationDelivery(),o.isAvailable()&&i("#billing_pickup_location_notice").removeClass("hidden").show())},maybeInitSelect2:function(){i().selectWoo&&i("select#pickup_location").each((function(){var e=i(this),o={placeholder:e.attr("data-placeholder")||e.attr("placeholder")||"",label:e.attr("data-label")||null,width:"100%",dropdownCssClass:"wc-gzd-pickup-location-select-dropdown"};i(this).on("select2:select",(function(){i(this).trigger("focus")})).selectWoo(o)}))},onSelectPickupLocation:function(){var o=e.shipments_pickup_locations.getPickupLocationSelect().val();i("#current_pickup_location").val(o).trigger("change"),i(this).parents(".wc-gzd-modal-content").find(".wc-gzd-modal-close").trigger("click");var n=i("#shipping_address_1_field");return i.scroll_to_notices(n),!1},updateCustomerNumberField:function(i){var o=e.shipments_pickup_locations.getCustomerNumberField();i.supports_customer_number?(o.find("label")[0].firstChild.nodeValue=i.customer_number_field_label+" ",i.customer_number_is_mandatory?(o.find("label .required").length||o.find("label").append(' <abbr class="required">*</abbr>'),o.find("label .optional").hide(),o.addClass("validate-required")):(o.find("label .required").remove(),o.find("label .optional").show(),o.removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field")),o.removeClass("hidden"),o.show()):(o.addClass("hidden"),o.hide())},getPickupLocationSelect:function(){return i("#pickup_location")},getPickupLocation:function(o,n=!0){var t=e.shipments_pickup_locations;if(t.pickupLocations.hasOwnProperty(o))return t.pickupLocations[o];if(n){var c=i("#current_pickup_location");if(c.attr("data-current-location"))try{var a=JSON.parse(c.attr("data-current-location"));if(a.code===o)return a}catch(i){}}return!1},afterRefreshCheckout:function(i,o){var n=e.shipments_pickup_locations,t=!1,c=n.pickupLocations,a=n.currentProvider;(o=void 0===o?{fragments:{".gzd-shipments-current-provider":"",".gzd-shipments-pickup-location-supported":!1,".gzd-shipments-pickup-locations":JSON.stringify(n.pickupLocations)}}:o).hasOwnProperty("fragments")&&(o.fragments.hasOwnProperty(".gzd-shipments-current-provider")&&(n.currentProvider=o.fragments[".gzd-shipments-current-provider"]),n.currentProvider&&a===n.currentProvider||n.hasPickupLocationDelivery()&&n.disablePickupLocationDelivery(!0),o.fragments.hasOwnProperty(".gzd-shipments-pickup-location-supported")&&(t=o.fragments[".gzd-shipments-pickup-location-supported"]),o.fragments.hasOwnProperty(".gzd-shipments-pickup-locations")&&(n.pickupLocations=JSON.parse(o.fragments[".gzd-shipments-pickup-locations"]),n.updatePickupLocationSelect(c))),t?n.enable():n.disable()},disable:function(){var o=e.shipments_pickup_locations;o.available=!1,o.hasPickupLocationDelivery()&&o.disablePickupLocationDelivery(!0),i(".pickup_location_notice").addClass("hidden").hide()},enable:function(){var o=e.shipments_pickup_locations;o.available=!0,i(".pickup_location_notice").removeClass("hidden").show(),i("#ship-to-different-address-checkbox").is(":checked")||o.hasPickupLocationDelivery()?i("#billing_pickup_location_notice").addClass("hidden").hide():i("#billing_pickup_location_notice").removeClass("hidden").show()},isAvailable:function(){return e.shipments_pickup_locations.available},replaceShippingAddress:function(o){var n=e.shipments_pickup_locations,t=i("#ship-to-different-address input"),c=[];Object.keys(o).forEach((e=>{var t=o[e];if(t&&i("#shipping_"+e).length>0){i("#shipping_"+e).val()!==t&&c.push(e),i("#shipping_"+e).val(t),i("#shipping_"+e).prop("readonly",!0),"country"===e&&i("#shipping_"+e).trigger("change");var a=i("#shipping_"+e+"_field");a.length>0?(a.addClass("wc-gzd-shipments-managed-by-pickup-location"),a.find(".wc-gzd-shipments-managed-by-pickup-location-notice").length<=0&&a.find("label").after('<span class="wc-gzd-shipments-managed-by-pickup-location-notice">'+n.params.i18n_managed_by_pickup_location+"</span>")):i("#shipping_"+e).addClass("wc-gzd-shipments-managed-by-pickup-location")}})),t.is(":checked")||(t.prop("checked",!0),t.trigger("change")),c.length>0&&-1!==i.inArray("postcode",c)&&i("#shipping_postcode").trigger("change")}},i(document).ready((function(){e.shipments_pickup_locations.init()})),((window.wcGzdShipments=window.wcGzdShipments||{}).static=window.wcGzdShipments.static||{})["pickup-locations"]={}}();